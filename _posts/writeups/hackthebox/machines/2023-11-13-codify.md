---
title: Write-up Codify [Easy] - Hack The Box
date: 2023-11-13
categories: [Writeups, Hack The Box]
tags: [writeup, hackthebox, machines, easy, pentesting]
image: /assets/img/hackthebox/machines/codify/codify.png
image_link: false
---

Publicación del write-up de sujeto a las [guías generales](https://help.hackthebox.com/en/articles/5188925-streaming-writeups-walkthrough-guidelines) de Hack The Box.

# Write-up Codify \[Easy\] - Hack The Box
\\
**Mi perfil de Hack The Box: [julianglez16](https://app.hackthebox.com/users/1084561)**


# Enumeración


### Puertos


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled.png)
![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(1).png)


### Directorios web


### Virtual hosts


### Tecnologías web


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(2).png)



### Funcionalidad web


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(3).png)
![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(4).png)
![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(5).png)



### Análisis con BurpSuite


# Explotación


### Usuario


La librería `vm2` utilizada para realizar el _sandboxing_ de las aplicaciones NodeJS está en la versión 3.9.19. Para esta versión existe una vulnerabilidad con la cual se puede escapar del _sandboxing_ y ejecutar comandos de manera remota disponible en [https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244](https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244)

Parte de la web donde se expone la versión utilizada de la librería de sandboxing JavaScript vm2:
![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(6).png)



![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(7).png)



Con el RCE se obtiene un reverse shell


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(8).png)


Desde el usuario `svc` se puede ver un fichero en la ruta `/opt/scripts/mysql-backup.sh` desde el cual se actualiza la base de datos mysql


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(9).png)



En el directorio `/var/www/contacts` existe una base de datos donde se encuentra el hash de la contraseña del usuario `joshua`.


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(10).png)



Tras crackear el hash, se obtiene la contraseña del usuario `joshua`


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(11).png)



### Root


El usuario `joshua` tiene permisos de `sudo` para ejecutar el script que se encontró antes ubicado en `/opt/scripts`

![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(12).png)


Utilizando el _wildcard_ _`*`_ se puede _bypassear_ la comprobación de la contraseña introducida por el usuario y la que existe en el fichero `/root/.creds`. Realizando esto, se consigue que la contraseña introducida desde el script por comandos pueda ser loggeada por algún programa de monitorización de procesos como `pspy64`. 


![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(13).png)
![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(14).png)



Utilizando esta contraseña se puede escalar privilegios al usuario `root`.

![Untitled.png](/assets/img/hackthebox/machines/codify/Untitled%20(15).png)
