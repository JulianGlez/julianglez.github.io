---
title: Write-up Agile [Medium] - Hack The Box
date: 2023-04-13
categories: [Writeups, Hack The Box]
tags: [writeup, hackthebox, machines, medium, pentesting]
image: /assets/img/hackthebox/machines/agile/agile.png
image_link: false
---

Publicación del write-up de sujeto a las [guías generales](https://help.hackthebox.com/en/articles/5188925-streaming-writeups-walkthrough-guidelines) de Hack The Box.

# Write-up Agile \[Medium\] - Hack The Box
\\
**Mi perfil de Hack The Box: [julianglez16](https://app.hackthebox.com/users/1084561)**

# Enumeración


### Puertos


![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled.png)


### Directorios web


![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(1).png)

### Virtual hosts

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(2).png)

### Tecnologías web

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(3).png)


### Funcionalidad web

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(4).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(5).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(6).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(7).png)

### Análisis con BurpSuite


Al añadir una contraseña se realiza una petición POST al servidor

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(8).png)


Una vez añadidas contraseñas, al hacer click en el botón _Export_ se realizan dos peticiones GET consecutivas al servidor

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(9).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(10).png)



# Explotación


### Usuario


En la segunda petición GET de la función _Export_ existe un LFI

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(11).png)



Desde dicho LFI se puede ver un directorio interesante en _/app/app-testing._ Al aplicar el LFI sobre dicho directorio salta un error pero en la respuesta HTML se puede ver un fichero interesante dentro del mismo.

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(12).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(13).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(14).png)



Se puede ver que existen cuatro endpoints susceptibles de un IDOR:

	- /vault/edit_row/<id>
	- /vault/row/<id>
	- /vault/update/<id>
	- /vault/delete/<id>

En el endpoint _/vault/row/10_ se encuentra nuestra contraseña

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(15).png)



Por lo que se intenta obtener alguna contraseña anteriormente almacenada desde el intruder de BurpSuite. En el número 8 debería (a mí no) aparecer las credenciales de un usuario para poder hacer SSH: `corum:5db7caa1d13cc37c9fc2`.

Captura obtenida de un writeup ajeno:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(16).png)


### Root


Desde el usuario se encuentra un binario sospechoso con permisos SUID.

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(17).png)



Puertos abiertos

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(18).png)



Para averiguar qué servicio corresponde con cada puerto se usa el comando `ps faux | grep [puerto]`

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(19).png)



Se puede ver que en el puerto 41829 está corriendo un proceso de _Google Chrome_ por lo que se puede hacer un tunel SSH para poder observarlo desde nuestra máquina local con el comando 


```bash
ssh -L 5000:127.0.0.1:41289 corum@10.10.11.203
```

Explicación visual de lo que estamos realizando con el tunel SSH. El comando utilizado en este ejemplo sería ssh -L 8080:192.168.0.3:80 foo@192.168.0.2:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(20).png)


![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(21).png)



Una vez creado el tunel ssh, desde _Google Chrome_ en la URL _chrome://inspect,_ se puede acceder a las herramientas de desarrollador y configurar un objetivo de red nuevo 


Antes de configurar el puerto del tunel ssh:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(22).png)

Después de configurar el puerto del tunel ssh:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(23).png)



Tras configurar los ajustes de descubrimiento de red aparece un nuevo subdominio en el endpoint de S_uperPassword_

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(24).png)



Al darle a _inspect_ se puede acceder a la página web de test. En el apartado de contraseñas se enceuntra la contraseña del usuario `edwards`. Con esta contraseña se puede acceder a la máquina con las credenciales `edwards:xxxxxxxx`.

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(25).png)



Una vez dentro del usuario `edwards`, con `sudo -l`  se observan dos comandos que pueden ayudar a escalar privilegios hacia el usuario `root`.

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(26).png)



Con el comando `sudoedit -u dev_admin /app/config_test.json` se abre el siguiente fichero donde se observan credenciales de la base de datos mysql: `superpasstester:xxxxxxxxx`

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(27).png)



Con el comando `sudoedit -u dev_admin /app/app-testing/tests/functional/creds.txt` se abre el siguiente fichero donde se observan unas credenciales del usuario `edwards` de algún servicio desconocido: `edwards:xxxxxxxxx`

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(28).png)


Para comenzar la búsqueda de escalada de privilegios se utiliza la conexión al servidor `mysql` con las credenciales encontradas en el fichero `config_test.json`.

![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(29).png)
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(30).png)



No se obtiene demasiada información ya que estas contraseñas ya las hemos visto en la web desde _Google Chrome_ por lo que se intenta hacer un cambio de usuario al usuario `root` con la contraseña encontrada en el otro fichero. Tampoco funciona.


El [CVE-2023-22809](https://www.synacktiv.com/sites/default/files/2023-01/sudo-CVE-2023-22809.pdf) permite escalar privilegios a través de la variable _EDITOR_ cuando se utiliza sudoedit con permisos de sudo. 


Existe una tarea recurrente ejecutada desde el usuario root que activa el entorno virtual de la aplicación. Combinando la vulnerabilidad mencionada y este comportamiento se puede editar el fichero `/app/venv/bin/activate` para dar permisos de SUID a `/bin/bash`. 

Tarea recurrente observada desde pspy64:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(31).png)
Edición del fichero `/app/venv/bin/activate`:
![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(32).png)



Finalmente, esperar un tiempo y ejecutar `bash -p` para escalar privilegios hasta `root`.


![Untitled.png](/assets/img/hackthebox/machines/agile/Untitled%20(33).png)
